
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ticket Management System - Solarium Customer App</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: #f8f9fa;
        }
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: #ffffff;
            padding: 0;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            border-right: 1px solid #e9ecef;
        }
        .sidebar h3 {
            background: #007bff;
            color: white;
            margin: 0;
            padding: 20px;
            font-size: 18px;
            font-weight: 600;
        }
        .nav-section {
            padding: 20px 0;
        }
        .nav-section h4 {
            color: #6c757d;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0 20px 10px 20px;
            padding: 0;
        }
        .nav-link {
            display: block;
            color: #495057;
            text-decoration: none;
            padding: 12px 20px;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        .nav-link:hover {
            background: #f8f9fa;
            color: #007bff;
            border-left-color: #007bff;
        }
        .nav-link.active {
            background: #e3f2fd;
            color: #007bff;
            border-left-color: #007bff;
        }
        .main-content {
            margin-left: 280px;
            padding: 40px;
            background: white;
            min-height: 100vh;
        }
        .content {
            max-width: 800px;
            line-height: 1.6;
        }
        pre {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #e9ecef;
        }
        code {
            background: #f8f9fa;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #e83e8c;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2, h3 {
            color: #2c3e50;
            margin-top: 30px;
        }
        .breadcrumb {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #6c757d;
        }
        @media (max-width: 768px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
            }
            .main-content {
                margin-left: 0;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3>Solarium Customer App</h3>
        <nav>
            <div class="nav-section"><a href="index.html" class="nav-link">üè† Home</a></div><div class="nav-section"><h4>Core Features</h4><a href="CartCheckout.html" class="nav-link">Cart Checkout</a><a href="CartFunctionality.html" class="nav-link">Cart Functionality</a><a href="KycUploadLibrary.html" class="nav-link">KYC Upload Library</a><a href="ServicesCatalogue.html" class="nav-link">Services Catalogue</a><a href="profile-feature.html" class="nav-link">Profile Management</a></div><div class="nav-section"><h4>Support System</h4><a href="TicketManagement.html" class="nav-link">Ticket Management System</a></div><div class="nav-section"><h4>Testing & QA</h4><a href="TESTING.html" class="nav-link">Testing Guide</a><a href="Testing_services_cart.html" class="nav-link">Testing Services & Cart</a></div><div class="nav-section"><h4>DevOps</h4><a href="CI_CD.html" class="nav-link">CI/CD Pipeline</a></div><div class="nav-section"><h4>Other</h4><a href="LeadDetail.html" class="nav-link">Lead Detail</a></div>
        </nav>
    </div>
    <div class="main-content">
        <div class="breadcrumb">Documentation ‚Üí Ticket Management System</div>
        <div class="content">
            <h1>Ticket Management System</h1>
<h2>Overview</h2>
<p>The SolariumCustApp features a comprehensive support ticket system that allows users to create, manage, and track support requests. The system provides real-time communication between customers and support staff with a chat-like interface.</p>
<h2>Key Features</h2>
<h3>üé´ Ticket Creation</h3>
<ul>
<li><strong>Create New Tickets</strong>: Users can create support tickets from the Help screen</li>
<li><strong>Lead-specific Tickets</strong>: Tickets can be associated with specific leads (must be status &quot;Executed&quot;)</li>
<li><strong>Subject &amp; Description</strong>: Full ticket details with categorization</li>
<li><strong>Automatic Assignment</strong>: Tickets are automatically routed to appropriate support staff</li>
</ul>
<h3>üí¨ Ticket Communication</h3>
<ul>
<li><strong>Chat Interface</strong>: Message-based communication system</li>
<li><strong>Real-time Updates</strong>: Live polling for new messages and status changes</li>
<li><strong>Message History</strong>: Complete conversation thread preservation</li>
<li><strong>Multiple Participants</strong>: Support for Customer, Admin, and KAM (Key Account Manager) roles</li>
</ul>
<h3>üìã Ticket Management</h3>
<ul>
<li><strong>Ticket Listing</strong>: Comprehensive view of all user tickets</li>
<li><strong>Status Tracking</strong>: Open/Closed status management</li>
<li><strong>Ticket Reopening</strong>: Ability to reopen closed tickets with reasons</li>
<li><strong>Lead Integration</strong>: Tickets displayed in Lead Detail screens</li>
</ul>
<h3>üîÑ Real-time Features</h3>
<ul>
<li><strong>Live Polling</strong>: Automatic updates every 30 seconds (¬±5s jitter) when screen is active</li>
<li><strong>Pull-to-refresh</strong>: Manual refresh with 30-second debouncing</li>
<li><strong>Focus-based Lifecycle</strong>: Polling starts/stops based on screen visibility</li>
<li><strong>Background Handling</strong>: Polling pauses when app is backgrounded</li>
</ul>
<h2>Architecture</h2>
<h3>Components</h3>
<h4><strong>HelpScreen</strong> (<code>src/screens/main/HelpScreen.tsx</code>)</h4>
<ul>
<li>Main tickets listing screen</li>
<li>Create new ticket functionality</li>
<li>Pull-to-refresh support</li>
<li>Real-time polling management</li>
</ul>
<h4><strong>TicketsTab</strong> (<code>src/screens/main/LeadDetail/TicketsTab.tsx</code>)</h4>
<ul>
<li>Lead-specific ticket view</li>
<li>Embedded in Lead Detail screen</li>
<li>Filtered ticket listing by lead ID</li>
</ul>
<h4><strong>TicketThreadScreen</strong> (<code>src/screens/main/TicketThreadScreen.tsx</code>)</h4>
<ul>
<li>Individual ticket conversation view</li>
<li>Message sending functionality</li>
<li>Ticket reopening capabilities</li>
<li>Chat-like interface</li>
</ul>
<h4><strong>CreateTicketModal</strong> (<code>src/components/modals/CreateTicketModal.tsx</code>)</h4>
<ul>
<li>Modal for creating new support tickets</li>
<li>Form validation and submission</li>
<li>Lead selection dropdown</li>
</ul>
<h4><strong>TicketListItemComponent</strong> (<code>src/components/tickets/TicketListItemComponent.tsx</code>)</h4>
<ul>
<li>Individual ticket display component</li>
<li>Status indicators and metadata</li>
<li>Navigation to ticket thread</li>
</ul>
<h4><strong>MessageBubble</strong> (<code>src/components/tickets/MessageBubble.tsx</code>)</h4>
<ul>
<li>Chat message display component</li>
<li>Sender identification (Customer/Admin/KAM)</li>
<li>Timestamp and formatting</li>
</ul>
<h3>State Management</h3>
<h4><strong>Tickets Slice</strong> (<code>src/store/ticketsSlice.ts</code>)</h4>
<ul>
<li>Redux Toolkit slice for ticket state</li>
<li>24-hour TTL cache management</li>
<li>Auto-sync with RTK Query</li>
<li>Selectors for data access:<ul>
<li><code>selectTickets</code> - All tickets</li>
<li><code>selectTicketById</code> - Individual ticket</li>
<li><code>selectTicketsByLeadId</code> - Lead-specific tickets</li>
<li><code>selectOpenTicketsCount</code> - Count of open tickets</li>
<li><code>selectIsTicketsCacheValid</code> - Cache validity check</li>
<li><code>selectTicketsCacheTimestamp</code> - Cache timestamp</li>
</ul>
</li>
</ul>
<h4><strong>API Integration</strong> (<code>src/api/endpoints/tickets.ts</code>)</h4>
<ul>
<li>RTK Query endpoints for ticket operations</li>
<li>Automatic caching and invalidation</li>
<li>Error handling and retry logic</li>
</ul>
<h3>API Endpoints</h3>
<pre><code class="language-typescript">// Get all tickets with pagination and filtering
GET /tickets?offset=0&amp;limit=25&amp;status=Open&amp;cpId=123&amp;customerId=456&amp;dateRange=2024-01

// Get specific ticket with messages
GET /tickets/{ticketId}

// Create new ticket (requires executed lead)
POST /tickets
Body: { leadId: string, subject: string, description: string }

// Add message to ticket
POST /tickets/{ticketId}/messages
Body: { message: string }

// Reopen closed ticket
PATCH /tickets/{ticketId}/reopen
Body: { reason: string }
</code></pre>
<h3>Data Models</h3>
<pre><code class="language-typescript">interface Ticket {
  ticketId: string;
  leadId: string;
  subject: string;
  description: string;
  status: &#39;Open&#39; | &#39;Closed&#39;;
  messages: TicketMessage[];
  createdAt: string;
  createdBy: string;
  closedAt: string | null;
}

interface TicketListItem {
  ticketId: string;
  leadId: string;
  subject: string;
  status: &#39;Open&#39; | &#39;Closed&#39;;
  createdAt: string;
  createdBy: string;
}

interface TicketMessage {
  sender: &#39;Customer&#39; | &#39;Admin&#39; | &#39;KAM&#39;;
  timestamp: string;
  message: string;
}
</code></pre>
<h2>Real-time Configuration</h2>
<h3>Polling Settings</h3>
<ul>
<li><strong>Base Interval</strong>: 30 seconds</li>
<li><strong>Jitter Range</strong>: ¬±5 seconds</li>
<li><strong>Debounce Window</strong>: 30 seconds (from <code>DEBOUNCE_WINDOWS.TICKETS</code>)</li>
<li><strong>Background Behavior</strong>: Stops polling when app backgrounded</li>
<li><strong>Resume Delay</strong>: 5 seconds after app foregrounds</li>
</ul>
<h3>Cache Management</h3>
<ul>
<li><strong>TTL</strong>: 24 hours (mentioned in slice comments)</li>
<li><strong>Storage</strong>: Redux with persistence</li>
<li><strong>Invalidation</strong>: Automatic via RTK Query tags</li>
</ul>
<h2>Hooks</h2>
<h3><strong>useTicketPolling</strong> (<code>src/hooks/useTicketPolling.ts</code>)</h3>
<ul>
<li>Manages automatic polling lifecycle</li>
<li>Integrates with refresh control system</li>
<li>Handles app state transitions</li>
<li>Provides jitter to prevent thundering herd</li>
</ul>
<h3><strong>useRefreshControl</strong> (<code>src/hooks/useRefreshControl.ts</code>)</h3>
<ul>
<li>Provides <code>refreshTickets()</code> and <code>canRefreshTickets()</code></li>
<li>Enforces 30-second debounce window</li>
<li>Coordinates with polling system</li>
</ul>
<h2>Debug Tools</h2>
<h3><strong>TicketsDebugger</strong> (<code>src/components/debug/TicketsDebugger.tsx</code>)</h3>
<ul>
<li>Built-in debugging interface for ticket API</li>
<li>Test ticket creation, message sending</li>
<li>Monitor polling status and cache state</li>
<li>View Redux selectors output</li>
</ul>
<h2>Performance Features</h2>
<h3>Caching Strategy</h3>
<ul>
<li><strong>RTK Query caching</strong>: Automatic background updates</li>
<li><strong>Redux persistence</strong>: Tickets persist across app restarts</li>
<li><strong>Selective refresh</strong>: Only fetches when outside debounce window</li>
<li><strong>Tag-based invalidation</strong>: Efficient cache updates</li>
</ul>
<h3>Memory Management</h3>
<ul>
<li><strong>Focus-based polling</strong>: Only active when screen visible</li>
<li><strong>Automatic cleanup</strong>: Timers cleared on unmount</li>
<li><strong>Efficient selectors</strong>: Memoized data access</li>
<li><strong>Jitter</strong>: Prevents synchronized requests</li>
</ul>
<h2>User Workflows</h2>
<h3>Creating a Ticket</h3>
<ol>
<li>Navigate to Help screen or Lead Detail</li>
<li>Tap &quot;Create Ticket&quot; FAB/button</li>
<li>Select lead (if from Help screen)</li>
<li>Fill subject and description</li>
<li>Submit - only works for &quot;Executed&quot; leads</li>
</ol>
<h3>Managing Conversations</h3>
<ol>
<li>Tap ticket from list to open thread</li>
<li>View message history in chat format</li>
<li>Send new messages via text input</li>
<li>Real-time updates via polling</li>
</ol>
<h3>Reopening Tickets</h3>
<ol>
<li>Open closed ticket thread</li>
<li>Tap reopen option</li>
<li>Provide reason for reopening</li>
<li>Submit - ticket returns to Open status</li>
</ol>

        </div>
    </div>
</body>
</html>
