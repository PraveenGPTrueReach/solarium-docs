
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Cart Functionality - Solarium Customer App</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: #f8f9fa;
        }
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: #ffffff;
            padding: 0;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            border-right: 1px solid #e9ecef;
        }
        .sidebar h3 {
            background: #007bff;
            color: white;
            margin: 0;
            padding: 20px;
            font-size: 18px;
            font-weight: 600;
        }
        .nav-section {
            padding: 20px 0;
        }
        .nav-section h4 {
            color: #6c757d;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 0 20px 10px 20px;
            padding: 0;
        }
        .nav-link {
            display: block;
            color: #495057;
            text-decoration: none;
            padding: 12px 20px;
            border-left: 3px solid transparent;
            transition: all 0.2s ease;
            font-weight: 500;
        }
        .nav-link:hover {
            background: #f8f9fa;
            color: #007bff;
            border-left-color: #007bff;
        }
        .nav-link.active {
            background: #e3f2fd;
            color: #007bff;
            border-left-color: #007bff;
        }
        .main-content {
            margin-left: 280px;
            padding: 40px;
            background: white;
            min-height: 100vh;
        }
        .content {
            max-width: 800px;
            line-height: 1.6;
        }
        pre {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #e9ecef;
        }
        code {
            background: #f8f9fa;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #e83e8c;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2, h3 {
            color: #2c3e50;
            margin-top: 30px;
        }
        .breadcrumb {
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #6c757d;
        }
        @media (max-width: 768px) {
            .sidebar {
                position: relative;
                width: 100%;
                height: auto;
            }
            .main-content {
                margin-left: 0;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3>Solarium Customer App</h3>
        <nav>
            <div class="nav-section"><a href="index.html" class="nav-link">üè† Home</a></div><div class="nav-section"><h4>Core Features</h4><a href="CartCheckout.html" class="nav-link">Cart Checkout</a><a href="CartFunctionality.html" class="nav-link">Cart Functionality</a><a href="KycUploadLibrary.html" class="nav-link">KYC Upload Library</a><a href="ServicesCatalogue.html" class="nav-link">Services Catalogue</a><a href="profile-feature.html" class="nav-link">Profile Management</a></div><div class="nav-section"><h4>Support System</h4><a href="TicketManagement.html" class="nav-link">Ticket Management System</a></div><div class="nav-section"><h4>Testing & QA</h4><a href="TESTING.html" class="nav-link">Testing Guide</a><a href="Testing_services_cart.html" class="nav-link">Testing Services & Cart</a></div><div class="nav-section"><h4>DevOps</h4><a href="CI_CD.html" class="nav-link">CI/CD Pipeline</a></div><div class="nav-section"><h4>Other</h4><a href="LeadDetail.html" class="nav-link">Lead Detail</a></div>
        </nav>
    </div>
    <div class="main-content">
        <div class="breadcrumb">Documentation ‚Üí Cart Functionality</div>
        <div class="content">
            <h1>Cart Functionality Documentation</h1>
<h2>Overview</h2>
<p>The cart system allows customers to collect solar services before proceeding to order. It&#39;s designed as a lightweight, persistent shopping cart with a 20-item limit.</p>
<h2>Architecture</h2>
<h3>Redux Store Structure</h3>
<pre><code class="language-typescript">// Global state shape
{
  servicesCart: {
    items: {
      &quot;solar-panel-install&quot;: {
        id: &quot;solar-panel-install&quot;,
        qty: 3,
        service: { /* full service object */ },
        addedAt: &quot;2024-01-15T10:30:00.000Z&quot;
      },
      &quot;solar-maintenance&quot;: {
        id: &quot;solar-maintenance&quot;,
        qty: 2,
        service: { /* full service object */ },
        addedAt: &quot;2024-01-15T10:35:00.000Z&quot;
      }
    },
    totalItems: 5,
    lastUpdated: &quot;2024-01-15T10:35:00.000Z&quot;
  }
}
</code></pre>
<h3>Key Design Decisions</h3>
<ol>
<li><strong>Service ID as Key</strong>: Fast O(1) lookups and updates</li>
<li><strong>Embedded Service Data</strong>: Avoids additional API calls for cart display</li>
<li><strong>Total Items Cache</strong>: Prevents recalculation on every render</li>
<li><strong>Timestamps</strong>: Enables future features like &quot;recently added&quot;</li>
</ol>
<h2>API Reference</h2>
<h3>Actions</h3>
<h4>addToCart</h4>
<pre><code class="language-typescript">dispatch(
  addToCart({
    service: Service,
    qty: (number = 1),
  })
);
</code></pre>
<ul>
<li>Adds new service or increases existing quantity</li>
<li>Validates 20-item total limit</li>
<li>Updates <code>totalItems</code> and <code>lastUpdated</code></li>
<li><strong>Idempotent</strong>: Safe to call multiple times</li>
</ul>
<h4>removeFromCart</h4>
<pre><code class="language-typescript">dispatch(
  removeFromCart({
    serviceId: string,
    qty: (number = 1),
  })
);
</code></pre>
<ul>
<li>Decreases quantity or removes service completely</li>
<li>Automatically removes service when quantity reaches 0</li>
<li>Updates totals</li>
</ul>
<h4>updateQuantity</h4>
<pre><code class="language-typescript">dispatch(
  updateQuantity({
    serviceId: string,
    qty: number,
  })
);
</code></pre>
<ul>
<li>Sets specific quantity (0 removes the service)</li>
<li>Validates 20-item limit</li>
<li>More efficient than multiple add/remove calls</li>
</ul>
<h4>removeService</h4>
<pre><code class="language-typescript">dispatch(removeService({serviceId: string}));
</code></pre>
<ul>
<li>Removes service completely regardless of quantity</li>
<li>Useful for &quot;remove item&quot; buttons</li>
</ul>
<h4>clearCart</h4>
<pre><code class="language-typescript">dispatch(clearCart());
</code></pre>
<ul>
<li>Empties entire cart</li>
<li>Resets all counters</li>
<li>Maintains timestamps for audit</li>
</ul>
<h3>Selectors</h3>
<h4>Basic Selectors</h4>
<pre><code class="language-typescript">const cartItems = useAppSelector(selectCartItems); // All items object
const cartArray = useAppSelector(selectCartItemsArray); // Items as array
const cartCount = useAppSelector(selectCartCount); // Total items
const isEmpty = useAppSelector(selectCartIsEmpty); // Boolean
const isFull = useAppSelector(selectIsCartFull); // Boolean (&gt;= 20)
const uniqueCount = useAppSelector(selectUniqueItemsCount); // Number of services
</code></pre>
<h4>Item-Specific Selectors</h4>
<pre><code class="language-typescript">const item = useAppSelector(selectCartItemById(serviceId)); // Single item or null
</code></pre>
<h3>Hook API</h3>
<h4>useCartActions Hook</h4>
<pre><code class="language-typescript">const {
  // Actions
  addToCart, // (service, qty?) =&gt; void
  removeFromCart, // (serviceId, qty?) =&gt; void
  updateQuantity, // (serviceId, qty) =&gt; void
  removeService, // (serviceId) =&gt; void
  clearCart, // () =&gt; void

  // State
  cartCount, // number
  uniqueItemsCount, // number
  isCartEmpty, // boolean
  isCartFull, // boolean
  cartItems, // Record&lt;string, CartItem&gt;
} = useCartActions();
</code></pre>
<h2>Business Rules</h2>
<h3>Item Limits</h3>
<ul>
<li><strong>Maximum 20 items total</strong> across all services</li>
<li><strong>No per-service limit</strong> (all 20 could be the same service)</li>
<li><strong>Minimum 1 item per service</strong> (0 removes the service)</li>
</ul>
<h3>Validation Rules</h3>
<pre><code class="language-typescript">// Quantity validation
if (qty &lt;= 0) return; // Ignore invalid quantities
if (qty &gt; 1000) return; // Reasonable upper bound

// Total limit validation
if (newTotal &gt; 20) {
  // Show user feedback
  // Don&#39;t update state
  return;
}
</code></pre>
<h3>Edge Cases Handled</h3>
<ul>
<li><strong>Adding to full cart</strong>: Shows &quot;Cart Full&quot; alert</li>
<li><strong>Negative quantities</strong>: Ignored with warning</li>
<li><strong>Non-existent services</strong>: Safely ignored</li>
<li><strong>Corrupted cart data</strong>: Reset to empty state</li>
<li><strong>Concurrent modifications</strong>: Redux ensures consistency</li>
</ul>
<h2>Persistence</h2>
<h3>Storage Strategy</h3>
<ul>
<li><strong>Encrypted Storage</strong>: Uses <code>react-native-encrypted-storage</code></li>
<li><strong>Whitelist Approach</strong>: Only cart state is persisted (not UI state)</li>
<li><strong>Transform Layer</strong>: Validates data integrity on load/save</li>
</ul>
<h3>Persistence Configuration</h3>
<pre><code class="language-typescript">// persistConfig.ts
{
  key: &#39;root&#39;,
  storage: securePersistAdapter,
  whitelist: [&#39;auth&#39;, &#39;servicesCart&#39;],
  transforms: [
    {
      key: &#39;servicesCart&#39;,
      in: (state) =&gt; validateAndTransform(state),
      out: (state) =&gt; validateAndRestore(state)
    }
  ]
}
</code></pre>
<h3>Corruption Recovery</h3>
<pre><code class="language-typescript">// If cart data is corrupted:
1. Log warning with error details
2. Reset cart to empty state: { items: {}, totalItems: 0, lastUpdated: null }
3. Continue app operation normally
4. User is NOT logged out (cart is non-critical)
</code></pre>
<h2>UI Integration</h2>
<h3>Services Screen Integration</h3>
<h4>State Management</h4>
<pre><code class="language-tsx">const {addToCart, cartItems, isCartFull} = useCartActions();

// Get quantity for specific service
const cartItem = cartItems[service.serviceId];
const quantity = cartItem?.qty || 0;
</code></pre>
<h4>UI States</h4>
<pre><code class="language-tsx">// ADD Button (quantity = 0)
{
  quantity === 0 &amp;&amp; (
    &lt;Button onPress={() =&gt; addToCart(service)}&gt;
      {isCartFull ? &#39;Cart Full&#39; : &#39;ADD&#39;}
    &lt;/Button&gt;
  );
}

// Quantity Controls (quantity &gt; 0)
{
  quantity &gt; 0 &amp;&amp; (
    &lt;View style={styles.quantityControls}&gt;
      &lt;TouchableOpacity onPress={() =&gt; removeFromCart(service.serviceId, 1)}&gt;
        &lt;Icon name=&quot;remove&quot; /&gt;
      &lt;/TouchableOpacity&gt;
      &lt;Text&gt;{quantity}&lt;/Text&gt;
      &lt;TouchableOpacity onPress={() =&gt; addToCart(service, 1)}&gt;
        &lt;Icon name=&quot;add&quot; /&gt;
      &lt;/TouchableOpacity&gt;
    &lt;/View&gt;
  );
}
</code></pre>
<h3>Cart Badge Integration</h3>
<pre><code class="language-tsx">// Navigation header
const {cartCount} = useCartActions();

{
  cartCount &gt; 0 &amp;&amp; (
    &lt;Badge
      size={16}
      accessible={true}
      accessibilityLabel={`Cart has ${cartCount} item${
        cartCount === 1 ? &#39;&#39; : &#39;s&#39;
      }`}
      accessibilityLiveRegion=&quot;polite&quot;
    &gt;
      {cartCount &gt; 99 ? &#39;99+&#39; : cartCount}
    &lt;/Badge&gt;
  );
}
</code></pre>
<h2>Testing Strategies</h2>
<h3>Unit Tests</h3>
<pre><code class="language-typescript">// Test reducer logic
describe(&#39;servicesCartSlice&#39;, () =&gt; {
  it(&#39;should add items to cart&#39;, () =&gt; {
    const state = cartReducer(initialState, addToCart({service, qty: 2}));
    expect(state.totalItems).toBe(2);
    expect(state.items[service.serviceId].qty).toBe(2);
  });
});
</code></pre>
<h3>Integration Tests</h3>
<pre><code class="language-typescript">// Test hook integration
const {result} = renderHook(() =&gt; useCartActions());
act(() =&gt; {
  result.current.addToCart(mockService, 3);
});
expect(result.current.cartCount).toBe(3);
</code></pre>
<h3>Persistence Tests</h3>
<pre><code class="language-typescript">// Test cart survives app restart
it(&#39;should persist cart across app restarts&#39;, async () =&gt; {
  // Add items
  store.dispatch(addToCart({service, qty: 5}));

  // Simulate app restart
  const newStore = createStore();
  await persistor.rehydrate();

  // Verify persistence
  expect(newStore.getState().servicesCart.totalItems).toBe(5);
});
</code></pre>
<h2>Performance Considerations</h2>
<h3>Optimization Strategies</h3>
<ul>
<li><strong>Memoized Selectors</strong>: Cart count calculations cached</li>
<li><strong>Shallow Equality</strong>: Redux selectors use shallow comparison</li>
<li><strong>Batch Updates</strong>: Multiple cart operations in single action</li>
<li><strong>Minimal Re-renders</strong>: Only affected components update</li>
</ul>
<h3>Memory Usage</h3>
<ul>
<li><strong>Small Footprint</strong>: 5-8 services √ó ~1KB each = ~8KB total</li>
<li><strong>No Memory Leaks</strong>: Redux handles cleanup automatically</li>
<li><strong>Efficient Updates</strong>: Immutable operations via Immer</li>
</ul>
<h2>Debugging</h2>
<h3>Common Issues</h3>
<h4>Cart Not Updating</h4>
<pre><code class="language-typescript">// Check if action is dispatched
console.log(&#39;Dispatching addToCart:&#39;, {service, qty});

// Check if reducer is called
// Add logging to reducer

// Check if component is subscribed to correct state
const cartCount = useAppSelector(selectCartCount);
console.log(&#39;Current cart count:&#39;, cartCount);
</code></pre>
<h4>Persistence Issues</h4>
<pre><code class="language-typescript">// Check storage permissions
import EncryptedStorage from &#39;react-native-encrypted-storage&#39;;
EncryptedStorage.getItem(&#39;persist:root&#39;).then(console.log);

// Check transform functions
// Look for validation errors in console
</code></pre>
<h4>Performance Issues</h4>
<pre><code class="language-typescript">// Profile selector usage
import {createSelector} from &#39;@reduxjs/toolkit&#39;;

const selectExpensiveComputation = createSelector([selectCartItems], items =&gt; {
  console.time(&#39;cart-calculation&#39;);
  const result = expensiveCalculation(items);
  console.timeEnd(&#39;cart-calculation&#39;);
  return result;
});
</code></pre>
<h3>Debug Tools</h3>
<h4>Redux DevTools</h4>
<pre><code class="language-typescript">// Install Redux DevTools browser extension
// Actions appear as: servicesCart/addToCart
// State changes visible in real-time
</code></pre>
<h4>React Native Debugger</h4>
<pre><code class="language-typescript">// Access global store in console
console.log(store.getState().servicesCart);

// Dispatch actions manually
store.dispatch(addToCart({service: mockService, qty: 1}));
</code></pre>
<h2>Migration &amp; Versioning</h2>
<h3>Future Schema Changes</h3>
<pre><code class="language-typescript">// When cart structure changes, add migration:
const migration2to3 = (state: PersistedState): PersistedState =&gt; {
  if (state.servicesCart) {
    // Transform old structure to new structure
    state.servicesCart = transformCartSchema(state.servicesCart);
  }
  return state;
};
</code></pre>
<h3>Backward Compatibility</h3>
<ul>
<li><strong>Graceful Degradation</strong>: Old cart data doesn&#39;t crash app</li>
<li><strong>Progressive Enhancement</strong>: New features work with old data</li>
<li><strong>User Communication</strong>: Inform users of cart resets when necessary</li>
</ul>
<h2>Security</h2>
<h3>Data Protection</h3>
<ul>
<li><strong>Encrypted Storage</strong>: Cart data encrypted at rest</li>
<li><strong>No Sensitive Data</strong>: Only service IDs and quantities stored</li>
<li><strong>Input Sanitization</strong>: All user inputs validated</li>
</ul>
<h3>Privacy</h3>
<ul>
<li><strong>Local Storage</strong>: Cart data never leaves device</li>
<li><strong>No Tracking</strong>: Cart operations not sent to analytics</li>
<li><strong>User Control</strong>: Users can clear cart data anytime</li>
</ul>

        </div>
    </div>
</body>
</html>
